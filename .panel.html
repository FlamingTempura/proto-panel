<!DOCTYPE HTML>
<html>
<head>
	<link rel="stylesheet" href="style.css">
</head>
<body id="panel">
	<div id="applets">
		<button class="applet" id="bluetooth">
	<img id="bluetooth-icon" class="inactive" src="plugins/bluetooth/bluetooth.png">
	<img id="bluetooth-connected" class="active" src="plugins/bluetooth/bluetooth-connected.png">
</button>
<script>
(function () {
	'use strict';

	const { getAPI, $, log } = require('./client-utils.js');

	getAPI('bluetooth').then(bluetooth => {
		$('#bluetooth').addEventListener('click', () => bluetooth.openMenu());
		bluetooth.listen().listen(status => {
			//log(status);
			$('#bluetooth-icon').className = status.on ? 'active' : 'inactive';
			$('#bluetooth-icon').style.display = status.connected ? 'none' : 'block';
			$('#bluetooth-connected').style.display = status.connected ? 'block' : 'none';
		});

		//bluetooth.openMenu();
	});
}());
</script><button class="applet" id="audio">
	<img id="vol-bg" class="inactive" src="plugins/audio/vol.png">
	<img id="vol-mute" class="inactive" src="plugins/audio/vol-mute.png">
	<div id="vol-status" class="status">
		<img id="vol-status-icon" class="active" src="plugins/audio/vol.png">
	</div>
	<div id="vol-status-middle" class="status">
		<!-- push the middle slightly ahead to overlap each ring -->
		<img id="vol-status-middle-icon" class="active" src="plugins/audio/vol.png">
	</div>
</button>
<script>
(function () {
	'use strict';

	const { getAPI, $ } = require('./client-utils.js');

	getAPI('audio').then(audio => {
		$('#audio').addEventListener('click', () => audio.openMenu());

		audio.listen('sink').listen(devices => {
			let activeDevice = devices.find(d => d.active);
			if (!activeDevice) {
				// TODO: no audio icon
				return;
			}
			let { volume, mute } = activeDevice;
			// clip the volume to the rings
			let iconCropWidth;
			if (volume < 15) {
				iconCropWidth = 43;
			} else if (volume < 45) {
				iconCropWidth = 54;
			} else if (volume < 80) {
				iconCropWidth = 75;
			} else {
				iconCropWidth = 100;
			}
			$('#audio').title = mute ? 'Muted' : `Volume ${volume}%`;
			$('#vol-status').style.left = `${-100 + iconCropWidth}%`;
			$('#vol-status-icon').style.left = `${100 - iconCropWidth}%`;
			$('#vol-status-middle').style.left = `${-91 + iconCropWidth}%`;
			$('#vol-status-middle-icon').style.left = `${91 - iconCropWidth}%`;
			$('#vol-status-middle').style.display = !mute ? 'block' : 'none';
			$('#vol-mute').style.display = mute ? 'block' : 'none';
			$('#vol-status').style.display = !mute ? 'block' : 'none';
			$('#vol-bg').style.display = !mute ? 'block' : 'none';
		});
	});
}());
</script><button class="applet" id="network">
	<img id="net-none" class="active" src="plugins/network/net-none.png">
	<img id="net-wifi" class="inactive" src="plugins/network/net-wifi.png">
	<div id="net-wifi-status" class="status">
		<img id="net-wifi-status-icon" class="active" src="plugins/network/net-wifi.png">
	</div>
</button>
<script>
(function () {
'use strict';

const { getAPI, $, log } = require('./client-utils.js');

getAPI('network').then(network => {
	$('#network').addEventListener('click', () => network.openMenu());

	network.listen().listen(net => {
		$('#network').title = `${`Connected to ${net.name}` || 'Not connected'}`;
		$('#net-none').style.display = `${!net.type ? 'block' : 'none'}`;
		$('#net-wifi').style.display = `${net.type === 'wifi' ? 'block' : 'none'}`;
		$('#net-wifi-status-icon').style.top = `${100 - net.strength}%`;
		$('#net-wifi-status-icon').style.height = `${net.strength}%`;
		$('#net-wifi-status-icon').style.left = `${(100 - net.strength) / 2}%`;
		$('#net-wifi-status-icon').style.width = `${net.strength}%`;
	});

	//network.openMenu();
});
}());
</script><button class="applet" id="power">
	<img id="bat-bg" class="inactive" src="plugins/power/bat.png">
	<div id="bat-status" class="status">
		<img id="bat-status-icon" class="active" src="plugins/power/bat.png">
	</div>
	<img id="bat-charging" class="black" src="plugins/power/bat-charging.png">
	<img id="bat-critical" class="black" src="plugins/power/bat-critical.png">	
</button>
<script>
(function () {
	'use strict';

	const { getAPI, $ } = require('./client-utils.js');

	getAPI('power').then(power => {
		$('#power').addEventListener('click', () => power.openMenu());
		power.battery().listen(battery => {
			let remaining = isNaN(Number(battery.minutes)) ? '' : battery.hours ?
				`${battery.hours} hours and ${battery.minutes} minutes` :
				`${battery.minutes} minutes`;

			$('#power').title = battery.charging ?
				battery.percent === 100 ?
					'Plugged in. Battery is fully charged.' : 
					`Plugged in. Battery is ${battery.percent}% charged. ${remaining ? `About ${remaining} until charged.` : ''}` :
				`${battery.percent}% battery remaining. ${remaining ? `About ${remaining}.` : ''}`;

			$('#bat-bg').className = !battery.charging && battery.percent < 10 ? 'red' : 'inactive';
			$('#bat-status').style.top = `${100 - battery.percent}%`;
			$('#bat-status-icon').style.top = `${-100 + battery.percent}%`;
			$('#bat-charging').style.display = battery.charging ? 'block' : 'none';
			$('#bat-critical').style.display = !battery.charging && battery.percent < 10 ? 'block' : 'none';
		});

	//power.openMenu();
	});
}());
</script><button class="applet" id="clock"></button>
<script>
(function () {
	'use strict';
	
	const { getAPI, $ } = require('./client-utils.js');
	const $clock = $('#clock');

	getAPI('clock').then(clock => {
		clock.time().listen(time => $clock.textContent = time);
		$clock.addEventListener('click', () => clock.showCalendar());
	});
}());
</script><!--APPLETS-->
	</div>
</body>
<script>
(function () {
	'use strict';
	const { ipcRenderer } = require('electron');
	const { $ } = require('./client-utils');
	setTimeout(() => {
		ipcRenderer.send('setSize', $('#applets').offsetWidth + 100);
	}, 2000);
}());
</script>
</html>