<button class="applet" id="power">
	<div class="icon">
		<img id="bat-bg" class="inactive" src="plugins/power/bat.png">
		<div id="bat-status" class="status">
			<img id="bat-status-icon" class="active" src="plugins/power/bat.png">
		</div>
		<img id="bat-charging" class="black" src="plugins/power/bat-charging.png">
		<img id="bat-critical" class="black" src="plugins/power/bat-critical.png">	
	</div>
</button>
<script>
(function () {
	'use strict';

	const { getAPI, $ } = require('./client-utils.js');

	getAPI('power').then(power => {
		$('#power').addEventListener('click', () => power.openMenu());
		power.battery().listen(battery => {
			let remaining = isNaN(Number(battery.minutes)) ? '' : battery.hours ?
				`${battery.hours} hours and ${battery.minutes} minutes` :
				`${battery.minutes} minutes`;

			$('#power').title = battery.charging ?
				battery.percent === 100 ?
					'Plugged in. Battery is fully charged.' : 
					`Plugged in. Battery is ${battery.percent}% charged. ${remaining ? `About ${remaining} until charged.` : ''}` :
				`${battery.percent}% battery remaining. ${remaining ? `About ${remaining}.` : ''}`;

			$('#bat-bg').className = !battery.charging && battery.percent < 10 ? 'red' : 'inactive';
			$('#bat-status').style.top = `${100 - battery.percent}%`;
			$('#bat-status-icon').style.top = `${-100 + battery.percent}%`;
			$('#bat-charging').style.display = battery.charging ? 'block' : 'none';
			$('#bat-critical').style.display = !battery.charging && battery.percent < 10 ? 'block' : 'none';
		});

	//power.openMenu();
	});
}());
</script>